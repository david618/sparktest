from centos:7

# Based on https://github.com/mesosphere/spark-build/blob/master/docker/Dockerfile
# This image includes libmesos.so
# This one using Spark 2.3.2; mesosphere's uses Spark 2.2.1
# docker build -f DockerfileMesosBuild . -t david62243/sparktest2

RUN yum -y install java-1.8.0-openjdk curl unzip subversion-libs libevent

RUN curl https://archive.apache.org/dist/spark/spark-2.3.2/spark-2.3.2-bin-hadoop2.7.tgz | tar -C /opt -zx

ADD ./target/dependency-jars/  /opt/dependency-jars/
ADD ./target/sparktest.jar /opt/

ARG LIBMESOS_BUNDLE_DOWNLOAD_URL="https://downloads.mesosphere.io/libmesos-bundle/libmesos-bundle-1.12.0.tar.gz"
ARG BOOTSTRAP_DOWNLOAD_URL="https://downloads.mesosphere.com/dcos-commons/artifacts/0.50.0/bootstrap.zip"


ARG MESOSPHERE_HOME="/opt/mesosphere"
ARG BOOTSTRAP_BINARY="${MESOSPHERE_HOME}/bootstrap.zip"
RUN mkdir -p ${MESOSPHERE_HOME} \
    && curl -L ${LIBMESOS_BUNDLE_DOWNLOAD_URL} | tar -C ${MESOSPHERE_HOME} -zx \
    && curl -L -o ${BOOTSTRAP_BINARY} ${BOOTSTRAP_DOWNLOAD_URL} \
    && unzip ${BOOTSTRAP_BINARY} -d ${MESOSPHERE_HOME} \
&& rm ${BOOTSTRAP_BINARY}

ENV BOOTSTRAP ${MESOSPHERE_HOME}/bootstrap
ENV MESOS_NATIVE_JAVA_LIBRARY ${MESOSPHERE_HOME}/libmesos-bundle/lib/libmesos.so
